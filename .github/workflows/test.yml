name: Test

on: [push, pull_request]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout code
            uses: actions/checkout@v2
      
          - name: Install stable toolchain
            uses: actions-rs/toolchain@v1
            with:
                profile: minimal
                toolchain: nightly-2023-10-04
                override: true


          - name: Run tests
            uses: actions-rs/cargo@v1
            with:
                command: test

    lints:
        name: Lints
        runs-on: ubuntu-latest
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                profile: minimal
                toolchain: nightly-2023-10-04
                override: true
                components: rustfmt, clippy
            
            - name: Format code
              uses: actions-rs/cargo@v1
              with:
                command: fmt
                args: --all -- --check
            
            - name: Run cargo clippy
              uses: actions-rs/cargo@v1
              with:
                command: clippy
                args: -- -D warnings
